#!/usr/bin/php
<?php
/**
 * Add news Job
 *
 * @author Gouverneur Thomas <tgo@ians.be>
 * @copyright Copyright (c) 2011, Gouverneur Thomas
 * @version 1.0
 * @package CLI
 * @category utils
 * @subpackage list
 * @filesource
 */

  require_once("../libs/config.inc.php");
  require_once("../libs/autoload.lib.php");
  require_once("../libs/functions.lib.php");

  $shortopts = "s::l::hnt";
  $opts = getopt($shortopts);

  if (isset($opts['h']) || !isset($opts['s']) || empty($opts['s'])) {
    echo $argv[0]." [-s=<synopsis>] [-l=<link>] [-t] [-n]\n";
    exit();
  }

  echo "[-] Connecting to MySQL...";
  $m = mysqlCM::getInstance();
  if ($m->connect()) {
    die($argv[0]." Error with SQL db: ".$m->getError()."\n");
  }
  echo "done\n";

  $syn = $opts['s'];
  $lin = $opts['l'];
  if (empty($syn)) die("Empty synopsis\n");
  $news = new News();
  $news->synopsis = $syn;
  $news->link = $lin;
  $news->date = time();
  $news->insert();
  if (empty($news->link)) {
    $msg = "[NEWS] ".$news->synopsis;
  } else {
    $msg = "[NEWS] ".$news->synopsis." (".$news->link.")";
  }
  if (!isset($opts['n']) && isset($opts['t'])) echo "RC=".Announce::getInstance()->msg(1, $msg);
  if (!isset($opts['n']) && !isset($opts['t'])) Announce::getInstance()->msg(0, $msg);
  if (isset($opts['n']) && isset($opts['t'])) echo "RC=".Announce::getInstance()->msg(10, $msg);
  echo "[-] Inserted.\n";
?>
