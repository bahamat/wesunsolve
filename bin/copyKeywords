#!/usr/bin/php
<?php
/**
 * Load bugids data into database
 *
 * @author Gouverneur Thomas <tgo@ians.be>
 * @copyright Copyright (c) 2011, Gouverneur Thomas
 * @version 1.0
 * @package CLI
 * @category utils
 * @subpackage list
 * @filesource
 */

  require_once("../libs/config.inc.php");
  require_once("../libs/autoload.lib.php");

  echo "[-] Connecting to MySQL...";
  $m = mysqlCM::getInstance();
  if ($m->connect()) {
    die($argv[0]." Error with SQL db: ".$m->getError()."\n");
  }
  echo "done\n";
  
  $link = mysql_connect('push.vpn.espix.org', 'wildcat', 'rootahph');
  mysql_select_db("opensolaris",$link);

  $r = mysql_query("SELECT `bug_id`,`keyword` FROM keywords");
  while ($row = mysql_fetch_assoc($r)) {
    $key = $row['keyword'];
    $id = $row['bug_id'];
    $k = new Keyword();
    $k->keyword = $key;
    if ($k->fetchFromField("keyword")) {
      $k->insert();
      echo "[-] New keyword inserted: $key\n";
    }
    $bug = new Bugid($id);
    $bug->addKeyword($k);
    echo "[-] Assigned keyword $key to $id\n";
  }

  echo "[-] Disonnecting from MySQL...";
  $m->disconnect();
  echo "done\n";
?>
