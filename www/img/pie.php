<?php
 /**
  * pie.php
  *
  * Draw a pie charts from URL's arguments
  *
  * 2009 - Gouverneur Thomas
  * thomas.gouverneur@belgacom.be
  */
 $colors = array(
   array(0x00,0x00,0x00),
   array(0x33,0x33,0x00),
   array(0x66,0x66,0x00),
   array(0x99,0x99,0x00),
   array(0xCC,0xCC,0x00),
   array(0xFF,0xFF,0x00),
   array(0x00,0x00,0x00),
   array(0x33,0x33,0x00),
   array(0x66,0x66,0x00),
   array(0x99,0x99,0x00),
   array(0xCC,0xCC,0x00),
   array(0xFF,0xFF,0x00),
   array(0x00,0x00,0x00),
   array(0x33,0x33,0x00),
   array(0x66,0x66,0x00),
   array(0x99,0x99,0x00),
   array(0xCC,0xCC,0x00),
   array(0xFF,0xFF,0x00),
   array(0x00,0x00,0x00),
   array(0x33,0x33,0x00),
   array(0x66,0x66,0x00),
   array(0x99,0x99,0x00),
   array(0xCC,0xCC,0x00),
   array(0xFF,0xFF,0x00),
   array(0x00,0x00,0x00),
   array(0x33,0x33,0x00),
   array(0x66,0x66,0x00),
   array(0x99,0x99,0x00),
   array(0xCC,0xCC,0x00),
   array(0xFF,0xFF,0x00),
   array(0x00,0x00,0x00),
   array(0x33,0x33,0x00),
   array(0x66,0x66,0x00),
   array(0x99,0x99,0x00),
   array(0xCC,0xCC,0x00),
   array(0xFF,0xFF,0x00),
   array(0x00,0x00,0x33),
   array(0x33,0x33,0x33),
   array(0x66,0x66,0x33),
   array(0x99,0x99,0x33),
   array(0xCC,0xCC,0x33),
   array(0xFF,0xFF,0x33),
   array(0x00,0x00,0x33),
   array(0x33,0x33,0x33),
   array(0x66,0x66,0x33),
   array(0x99,0x99,0x33),
   array(0xCC,0xCC,0x33),
   array(0xFF,0xFF,0x33),
   array(0x00,0x00,0x33),
   array(0x33,0x33,0x33),
   array(0x66,0x66,0x33),
   array(0x99,0x99,0x33),
   array(0xCC,0xCC,0x33),
   array(0xFF,0xFF,0x33),
   array(0x00,0x00,0x33),
   array(0x33,0x33,0x33),
   array(0x66,0x66,0x33),
   array(0x99,0x99,0x33),
   array(0xCC,0xCC,0x33),
   array(0xFF,0xFF,0x33),
   array(0x00,0x00,0x33),
   array(0x33,0x33,0x33),
   array(0x66,0x66,0x33),
   array(0x99,0x99,0x33),
   array(0xCC,0xCC,0x33),
   array(0xFF,0xFF,0x33),
   array(0x00,0x00,0x33),
   array(0x33,0x33,0x33),
   array(0x66,0x66,0x33),
   array(0x99,0x99,0x33),
   array(0xCC,0xCC,0x33),
   array(0xFF,0xFF,0x33),
   array(0x00,0x00,0x66),
   array(0x33,0x33,0x66),
   array(0x66,0x66,0x66),
   array(0x99,0x99,0x66),
   array(0xCC,0xCC,0x66),
   array(0xFF,0xFF,0x66),
   array(0x00,0x00,0x66),
   array(0x33,0x33,0x66),
   array(0x66,0x66,0x66),
   array(0x99,0x99,0x66),
   array(0xCC,0xCC,0x66),
   array(0xFF,0xFF,0x66),
   array(0x00,0x00,0x66),
   array(0x33,0x33,0x66),
   array(0x66,0x66,0x66),
   array(0x99,0x99,0x66),
   array(0xCC,0xCC,0x66),
   array(0xFF,0xFF,0x66),
   array(0x00,0x00,0x66),
   array(0x33,0x33,0x66),
   array(0x66,0x66,0x66),
   array(0x99,0x99,0x66),
   array(0xCC,0xCC,0x66),
   array(0xFF,0xFF,0x66),
   array(0x00,0x00,0x66),
   array(0x33,0x33,0x66),
   array(0x66,0x66,0x66),
   array(0x99,0x99,0x66),
   array(0xCC,0xCC,0x66),
   array(0xFF,0xFF,0x66),
   array(0x00,0x00,0x66),
   array(0x33,0x33,0x66),
   array(0x66,0x66,0x66),
   array(0x99,0x99,0x66),
   array(0xCC,0xCC,0x66),
   array(0xFF,0xFF,0x66),
   array(0x00,0x00,0x99),
   array(0x33,0x33,0x99),
   array(0x66,0x66,0x99),
   array(0x99,0x99,0x99),
   array(0xCC,0xCC,0x99),
   array(0xFF,0xFF,0x99),
   array(0x00,0x00,0x99),
   array(0x33,0x33,0x99),
   array(0x66,0x66,0x99),
   array(0x99,0x99,0x99),
   array(0xCC,0xCC,0x99),
   array(0xFF,0xFF,0x99),
   array(0x00,0x00,0x99),
   array(0x33,0x33,0x99),
   array(0x66,0x66,0x99),
   array(0x99,0x99,0x99),
   array(0xCC,0xCC,0x99),
   array(0xFF,0xFF,0x99),
   array(0x00,0x00,0x99),
   array(0x33,0x33,0x99),
   array(0x66,0x66,0x99),
   array(0x99,0x99,0x99),
   array(0xCC,0xCC,0x99),
   array(0xFF,0xFF,0x99),
   array(0x00,0x00,0x99),
   array(0x33,0x33,0x99),
   array(0x66,0x66,0x99),
   array(0x99,0x99,0x99),
   array(0xCC,0xCC,0x99),
   array(0xFF,0xFF,0x99),
   array(0x00,0x00,0x99),
   array(0x33,0x33,0x99),
   array(0x66,0x66,0x99),
   array(0x99,0x99,0x99),
   array(0xCC,0xCC,0x99),
   array(0xFF,0xFF,0x99),
   array(0x00,0x00,0xCC),
   array(0x33,0x33,0xCC),
   array(0x66,0x66,0xCC),
   array(0x99,0x99,0xCC),
   array(0xCC,0xCC,0xCC),
   array(0xFF,0xFF,0xCC),
   array(0x00,0x00,0xCC),
   array(0x33,0x33,0xCC),
   array(0x66,0x66,0xCC),
   array(0x99,0x99,0xCC),
   array(0xCC,0xCC,0xCC),
   array(0xFF,0xFF,0xCC),
   array(0x00,0x00,0xCC),
   array(0x33,0x33,0xCC),
   array(0x66,0x66,0xCC),
   array(0x99,0x99,0xCC),
   array(0xCC,0xCC,0xCC),
   array(0xFF,0xFF,0xCC),
   array(0x00,0x00,0xCC),
   array(0x33,0x33,0xCC),
   array(0x66,0x66,0xCC),
   array(0x99,0x99,0xCC),
   array(0xCC,0xCC,0xCC),
   array(0xFF,0xFF,0xCC),
   array(0x00,0x00,0xCC),
   array(0x33,0x33,0xCC),
   array(0x66,0x66,0xCC),
   array(0x99,0x99,0xCC),
   array(0xCC,0xCC,0xCC),
   array(0xFF,0xFF,0xCC),
   array(0x00,0x00,0xCC),
   array(0x33,0x33,0xCC),
   array(0x66,0x66,0xCC),
   array(0x99,0x99,0xCC),
   array(0xCC,0xCC,0xCC),
   array(0xFF,0xFF,0xCC),
   array(0x00,0x00,0xFF),
   array(0x33,0x33,0xFF),
   array(0x66,0x66,0xFF),
   array(0x99,0x99,0xFF),
   array(0xCC,0xCC,0xFF),
   array(0xFF,0xFF,0xFF),
   array(0x00,0x00,0xFF),
   array(0x33,0x33,0xFF),
   array(0x66,0x66,0xFF),
   array(0x99,0x99,0xFF),
   array(0xCC,0xCC,0xFF),
   array(0xFF,0xFF,0xFF),
   array(0x00,0x00,0xFF),
   array(0x33,0x33,0xFF),
   array(0x66,0x66,0xFF),
   array(0x99,0x99,0xFF),
   array(0xCC,0xCC,0xFF),
   array(0xFF,0xFF,0xFF),
   array(0x00,0x00,0xFF),
   array(0x33,0x33,0xFF),
   array(0x66,0x66,0xFF),
   array(0x99,0x99,0xFF),
   array(0xCC,0xCC,0xFF),
   array(0xFF,0xFF,0xFF),
   array(0x00,0x00,0xFF),
   array(0x33,0x33,0xFF),
   array(0x66,0x66,0xFF),
   array(0x99,0x99,0xFF),
   array(0xCC,0xCC,0xFF),
   array(0xFF,0xFF,0xFF),
   array(0x00,0x00,0xFF),
   array(0x33,0x33,0xFF),
   array(0x66,0x66,0xFF),
   array(0x99,0x99,0xFF),
   array(0xCC,0xCC,0xFF),
   array(0xFF,0xFF,0xFF)
  );

  $already_used = array(); 
  // wd=500&he=300&title=Entity count&values=title1,value1,title2,value2

  if (!isset($_GET["wd"]) ||
      !isset($_GET["he"]) ||
      !isset($_GET["title"]) ||
      !isset($_GET["values"])) die();

  require_once("/opt/app/ucc/libs/gdgraph.php");
  error_reporting(0);
  if (isset($_GET["fill"])) {
    $fill = $_GET["fill"];
  } else {
    $fill = 100;
  }
  //8D98A5
  //B4BAC2
  $gdg = new GDGraph($_GET["wd"],$_GET["he"],$_GET["title"],0xB4,0xBA,0xC2);

  $arr = array();

  $args = explode(',', $_GET["values"]);
  $i=0;
  $value = array();
  foreach ($args as $arg) {
    if ($i == 0) {
      $title = $arg;
    }
    else 
    if ($i == 1) {
      while(true) {
        $color = $colors[array_rand($colors)];
        if (isset($already_used[$color[0].$color[1].$color[2]])) {
          continue;
        } else {
          $already_used[$color[0].$color[1].$color[2]] = 1;
          break;
        }
      }
      $value[0] = $arg;
      $value[1] = $color[0];
      $value[2] = $color[1];
      $value[3] = $color[2];
      $arr[$title] = $value;
      $value = array();
      $title = "";
      $i = 0;
      continue;
    }
    $i++;
  }
  $gdg->pie_graph($arr, $fill, true, 0);
?>
